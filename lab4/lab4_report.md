University: [ITMO University](https://itmo.ru/ru/)

Faculty: [FICT](https://fict.itmo.ru)

Course: [Network programming](https://github.com/itmo-ict-faculty/network-programming)

Year: 2022/2023

Group: K34212

Author: Gavrilushkin Alexandr Alekseevich

Lab: Lab4

Date of create: 23.12.2022

Date of finished: 

# Базовая 'коммутация' и туннелирование, используя язык программирования P4

## Настройка окружения

1. Клонируем репозиторий [p4lang/tutorials](https://github.com/p4lang/tutorials)
2. Открываем консоль в папке vm-ubuntu-20.04. Проверяем, установлен ли Vagrant:

![](1.png)

3. Поднимаем машину командой:
```
vagrant up
```

4. Заходим в созданную виртуальную машину под учетной записью p4/p4. Переходим в каталог tutorials/exercices/basic. Поднимаем виртуальную сеть Mininet и компилируем basic.p4 командой (makefile уже есть в папке):
```
make run
```
5. Должна была подняться такая виртуальная сеть:

![](3.png)

7. Проверяем, что всё работает, узнав имя пользователя h1:

![](2.png)

## Basic Forwarding

В данном упражнении нужно дополнить скрипт basic.p4 так, чтобы в сети заработала переадресация IP-пакетов.
Алгоритм переадресации (свич):
1. Получает пакет;
2. Парсит пакет и получает целевой IP-адрес;
3. Сопоставляет IP с таблицей маршрутизации;
4. Если адреса нет, дропает пакет;
5. Если адрес есть, меняет ethernet-порт и целевой ethernet-адрес на соответствующие следующему узлу, а ethernet-адрес источника заменяет на свой;
6. Понижает TTL;
7. Запаковывает новые данные;
8. Отправляет пакет дальше.

Все нужные структуры данных (заголовки) созданы заранее. Нужно только написать логику парсера/депарсера, проверки таблицы и изменения пакета.

1. 
## Вывод
В процессе выполнения лабораторной работы я научился поднимать OpenVPN сервер на Ubuntu, познакомился с OS от Mikrotik. Пройдя путь боли и страданий, создал между сервером и CHR-клиентом VPN-туннель. Научился подключать к виртуальной машине удаленный рабочий стол через VNC (к ходу лабораторной работы это отношения не имеет, но навык есть навык).
